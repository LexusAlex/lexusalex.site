---
title: Регулярные выражения
description: >-
  Постепенно разберемся как работают регулярные выражения перейдем на реальных примерах
  от простого к сложному 
author: alex
date: 2055-06-02 09:00:00 +0300
categories: [Basics,Regexp]
tags: [regular expression]
image:
  path: /assets/img/posts/regexp.png
  alt: Регулярные выражения.
---

## Вместо введения

Регулярные выражения (Regexp) - это мощный и эффективный инструмент для работы с текстом.
Само по себе регулярное выражение предназначено для решения конкретных задач поиска или замены информации.

Регулярное выражение - это символьные стоки, предназначенные для сопоставления с текстом и манипулирования им.

## Базовый вариант

Базовый вариант регулярных выражений это простой поиск текста, где символы соответствуют сами себе, за исключением специальных символов. 

По умолчанию мы ищем только одно вхождение при этом регистр букв важен.

Например:

- регулярное выражение: `a`
- строка поиска и результат: <span style="background-color:#7AE;color:white">а</span>ааааааа

или

- регулярное выражение: `Алексей`
- строка поиска и результат: Привет, мое имя <span style="background-color:#7AE;color:white">Алексей</span>. Привет, мое имя Алексей

### Поиск части слова

Или же поиск по части слова:

- регулярное выражение: `ве`
- строка поиска и результат: При<span style="background-color:#7AE;color:white">ве</span>т

## Разделитель

Само регулярное выражение состоит из строки-шаблона. В роли ограничителей например могут выступать символы:

````text
/
~
@
;
%
#
````

Пример регулярного выражения с разделителем:
 
- регулярное выражение: `/строка/`
- строка поиска и результат: Тестовая <span style="background-color:#7AE;color:white">строка</span>

### Пример с разделителем и модификатором

Теперь представим есть строка **телефоны и на телефоне и не тот телефон**, нужно найти все вхождения слова _телефон_:

- регулярное выражение: `/телефон/`
- строка поиска и результат: <span style="background-color:#7AE;color:white">телефон</span>ы и на телефоне и не тот телефон

Но мы найдем только первое вхождение.

Для того чтобы найти все вхождения с регулярным выражением нужно применить модификатор `g`, что значит глобальный поиск по всей строке.

Модификаторы указываются после разделителя в конце:

- регулярное выражение: `/телефон/g`
- строка поиска и результат: <span style="background-color:#7AE;color:white">телефон</span>ы и на <span style="background-color:#7AE;color:white">телефон</span>е и не тот <span style="background-color:#7AE;color:white">телефон</span>

> Модификаторы или флаги модифицируют поведение регулярного выражения
{: .prompt-info }

Уже кое-что, но этого мало, ведь гибкость регулярных выражений раскрывается когда 
мы работаем с символьными классами.

## Символ точка

`.` - это специальный символ, совпадение с любым одиночным символом кроме пробельного.

- регулярное выражение: `/ca./g`
- строка поиска и результат: <span style="background-color:#7AE;color:white">cat</span> <span style="background-color:#7AE;color:white">car</span>

То есть на месте `.` может быть любой символ.

Еще пример:

- регулярное выражение: `/file./g`
- строка поиска и результат: <span style="background-color:#7AE;color:white">file1</span>.xls <span style="background-color:#7AE;color:white">file2</span>.xls <span style="background-color:#7AE;color:white">file3</span>.xls na1.xls na2.xls

Тут мы ищем имена файлов `file` и в конце ставим точку как любой символ, в итоге нашли 3 файла

> Важно помнить, что с шаблоном регулярного выражения совпадают не целые строки, а только отдельные символы из строки.
{: .prompt-info }

Точку можно применять в любом месте несколько раз.

Вот такой пример без глобального флага `g`: 

- регулярное выражение: `/.../`
- строка поиска и результат: <span style="background-color:#7AE;color:white">соб</span>ака

То есть любые три символа как раз попали.

Если нужно найти саму точку в строке, символ `.` нужно экранировать.

- регулярное выражение: `/file.\.xls/g`
- строка поиска и результат: <span style="background-color:#7AE;color:white">file1.xls</span> <span style="background-color:#7AE;color:white">file2.xls</span> <span style="background-color:#7AE;color:white">file3.xls</span> na1.xls na2.xls

Вот теперь попала точка + мы добавили расширение `.xls`

> Символ `\` всегда обозначает начало экранирования символов, например сам `\` экранируем так `\\`
{: .prompt-info }

## Символьные классы

Символьный класс - это комбинация символов определенного набора в квадратных скобках.

К примеру найдем возможные окончания строки **телефон**:

- регулярное выражение: `/телефон[еы]/g`
- строка поиска и результат: <span style="background-color:#7AE;color:white">телефоны</span> и на <span style="background-color:#7AE;color:white">телефоне</span> и не тот телефон

Но как найти просто **телефон**. Как сказать что символы символьного класса могут быть, а могут и не быть. 
Для этого существует квантификатор `?`. 

> Квантификатор - это ограничитель, который контролирует количество возможных повторений символов или класса символов
{: .prompt-info }

О квантификаторах поговорим ниже.

Для примера выше добавим его после символьного класса добавим квантификатор `?`.

- регулярное выражение: `/телефон[еы]?/g`
- строка поиска и результат: <span style="background-color:#7AE;color:white">телефоны</span> и на <span style="background-color:#7AE;color:white">телефоне</span> и не тот <span style="background-color:#7AE;color:white">телефон</span>

Теперь нашли все возможные варианты.

### Пример с поиском всех слов в строке
 
Еще пример, имеем последовательность **рай сад май вай Кай Сад**.
Задача найти все слова. Просто перечислим все нужные нам буквы.

- регулярное выражение: `/[КСвмсрайд]/g`
- строка поиска и результат: <span style="background-color:#7AE;color:white">рай</span> <span style="background-color:#7AE;color:white">сад</span> <span style="background-color:#7AE;color:white">май</span> <span style="background-color:#7AE;color:white">вай</span> <span style="background-color:#7AE;color:white">Кай</span> <span style="background-color:#7AE;color:white">Сад</span>

Можно конечно указать нужные буквы так `/[абвгдеёжзийклмнопрст]/`, но так никто не делает, есть способ проще.

### Диапазон символов

Укажем диапазоны символов:

- `[а-я]`
- `[А-Я]`
- `[a-z]`
- `[A-Z]`
- `[0-9]` - что эквивалентно `[0123456789]`

Либо сразу все символы: 

- `[a-zA-Zа-яА-Я0-9]`

> Избегайте ошибок указания диапазона значений меньше начала, например `[9-1]`
{: .prompt-info }

> Символьные классы могут быть в любом месте выражения.
{: .prompt-info }

#### Пример с поиском всех слов

С помощью символьных классов найдем все слова в строке **договор договоры договора**, Но при этом не перечисляя весь алфавит, а только нужные нам буквы.

- регулярное выражение: `/[а-до-ры]/g`
- строка поиска и результат: <span style="background-color:#7AE;color:white">договор</span> <span style="background-color:#7AE;color:white">договоры</span> <span style="background-color:#7AE;color:white">договора</span>

#### Пример с поиском определенного символа

Но чаще мы ищем не все слова, а только определенные слова и символы в тексте.

Например, нужно найти в тексте символ `,` и предшествующие ему определенные буквы:

- регулярное выражение: `/[авх],/g`
- строка поиска и результат: это тем<span style="background-color:#7AE;color:white">а,</span> которая привлекает внимание многих исследователей и специалистов в различных областях. Этот загадочный объект представляет интерес для астрономо<span style="background-color:#7AE;color:white">в,</span> физико<span style="background-color:#7AE;color:white">в,</span> биологов и других учены<span style="background-color:#7AE;color:white">х,</span> но также сопряжен с рядом подводных камней и опасностей. Давайте ближе рассмотрим некоторые из них

> Внутри могут быть литералы, которые меняют поведение символьного класса.
{: .prompt-info }

#### Отрицание

Иногда требуется найти символы кроме указанных в символьном классе.
Делается это с помощью символа `^`.

Например:

````text
[^а-и] - любой символ кроме указанного диапазона
[^А-Яа-яa-zA-Y0-9] - символы кроме указанных диапазонов
````

Посмотрим на пример с отрицанием:

- регулярное выражение: `/[^А-Яа-яa-zA-Y0-9]/g`
- строка поиска и результат: sdfgdfg<span style="background-color:#7AE;color:white">Z-!.</span>78абвг<span style="background-color:#7AE;color:white">,?</span>

Мы нашли все кроме всех указанных диапазонов. Что не попало в отрицание поиска - это символы `Z-!.,?`
 
Еще пример:

- регулярное выражение: `/file[13].xls/g`
- строка поиска и результат: <span style="background-color:#7AE;color:white">file1.xls</span> file2.xls <span style="background-color:#7AE;color:white">file3.xls</span> na1.xls na2.xls
 
Нашли, только `file1` и `file3`.

> Символ `^` обозначает отрицание всех символов в наборе, а не только первого символа идущего за ним.
{: .prompt-info } 

#### Поиск символа - (дефис)

Символ дефиса используется как указатель диапазона искомых символов `[0-9]`.
Но как его найти в тексте?

Для этого его нужно указать в начале или в конце символьного класса, при этом его совсем не обязательно экранировать, например:

- регулярное выражение: `/[-0-9]/g`
- строка поиска и результат: <span style="background-color:#7AE;color:white">-123454</span>

Или в конце класса, результат от этого не поменяется:

- регулярное выражение: `/[0-9-]/g`
- строка поиска и результат: <span style="background-color:#7AE;color:white">-123454</span>

#### Поиск других символов

Другие символы - это не буквы и не цифры можно найти тем же образом, перечислив их.

- регулярное выражение: `/[,.!~><()=+]/g`
- строка поиска и результат: <span style="background-color:#7AE;color:white">,.!~><()=+</span>

#### Предопределенные символьные классы

Помимо формы в квадратных скобках существует также краткая форма их записи:

````text
\d - целое число [0-9]
\D - символ кроме целого числа [^0-9]
\s - Пробельный символ [\f\n\r\t\v ]
\S - Символ кроме пробельного [^\f\n\r\t\v ]
\w - Буква,цифра и нижнее подчеркивание [a-zA-Z0-9_]
\W - Любой символ кроме буквы,цифры и нижнего подчеркивания [^a-zA-Z0-9_]
````

Рассмотрим примеры.

##### Целое число

Найдем все числа и дефис в тексте: 

- регулярное выражение: `/\d\d\d-/g`
- строка поиска и результат: номер <span style="background-color:#7AE;color:white">123-</span>

Как видим выглядит уже лучше, чем мы бы писали так `/[0-9][0-9][0-9]-/g`. Результат тот же.

##### Все кроме чисел

Если нужно найти все кроме чисел пишем `\D`

- регулярное выражение: `/\D/g`
- строка поиска и результат: <span style="background-color:#7AE;color:white">текст</span> 78 <span style="background-color:#7AE;color:white">вместе</span> 9 <span style="background-color:#7AE;color:white">с</span> <span style="background-color:#7AE;color:white">числами</span> 123<span style="background-color:#7AE;color:white">!</span>

##### Пробельный символ
 
Далее нужно понять что такое пробельный символ

> В пробельные символы входят
> - ` ` пробел
> - `\r` возврат каретки (CR)
> - `\n` перевод строки (LF)
> - `\t` табуляция
> - `\v` вертикальная табуляция
> - `\f` конец страницы
{: .prompt-info }

- регулярное выражение: `/\s/g`
- строка поиска и результат: много<span style="background-color:#7AE;color:white">  </span>пробелов<span style="background-color:#7AE;color:white"></span>еще<span style="background-color:#7AE;color:white"> </span>и<span style="background-color:#7AE;color:white"> </span>с<span style="background-color:#7AE;color:white"> </span>переносом<span style="background-color:#7AE;color:white"> </span>строки

##### Кроме пробельных символов

Обратная ситуация когда нам наоборот не нужны пробелы

- регулярное выражение: `/\S/g`
- строка поиска и результат: <span style="background-color:#7AE;color:white">текст</span> <span style="background-color:#7AE;color:white">с</span>   <span style="background-color:#7AE;color:white">пробелами</span> <span style="background-color:#7AE;color:white">123?</span>

#####  Латинские буквы и цифры

Существует так же команда под которую подходят буквы, цифры и нижнее подчеркивание.

- регулярное выражение: `/\w/g`
- строка поиска и результат: <span style="background-color:#7AE;color:white">Stay</span> <span style="background-color:#7AE;color:white">go</span> <span style="background-color:#7AE;color:white">home123</span> Русский текст

#####  Латинские не буквы и цифры

И обратная ситуация, когда попадет все кроме букв и цифр

Пример тот же, что и выше

- регулярное выражение: `/\W/g`
- строка поиска и результат: Stay<span style="background-color:#7AE;color:white"> </span>go<span style="background-color:#7AE;color:white"> </span>home123<span style="background-color:#7AE;color:white"> Русский текст</span>

### Кратко про символьные классы

## Квантификаторы

Квантификатор - это специальный ограничитель, который указывает на возможное кол-во повторений символа или символов перед ним.

### ?

`?` - означает, что символ или символы перед `?` могут быть ноль или один раз.

Простой пример:

- регулярное выражение: `/кто?/g`
- строка поиска и результат: <span style="background-color:#7AE;color:white">кто</span>о
- строка поиска и результат: <span style="background-color:#7AE;color:white">кто</span>
- строка поиска и результат: <span style="background-color:#7AE;color:white">кт</span>

Здесь подразумевается, что буква `o` может быть либо 0 или 1 раз, но не больше.

Еще пример:

- регулярное выражение: `/текст[0-9]?/g`
- строка поиска и результат: <span style="background-color:#7AE;color:white">текст</span>
- строка поиска и результат: <span style="background-color:#7AE;color:white">текст8</span>
- строка поиска и результат: <span style="background-color:#7AE;color:white">текст8</span>678

Здесь уже у нас символьный класс `[0-9]` и мы проверяем его наличие или отсутствие.

`?` У нас значит ноль или один раз.

### +

`+` - последовательность должна повторятся один или более раз

К примеру 

- регулярное выражение: `/текст[0-9]+/g`
- строка поиска и результат: текст
- строка поиска и результат: <span style="background-color:#7AE;color:white">текст7777777</span>
- строка поиска и результат: <span style="background-color:#7AE;color:white">текст7777777</span>,...7

Ключевое отличие `+` от `?` что обязательно должен быть один раз или более.

### *

`*` - символ может встречаться ноль или более раз.

Самый сильный квантификатор.

- регулярное выражение: `/текст[0-9]*/g`
- строка поиска и результат: <span style="background-color:#7AE;color:white">текст</span>
- строка поиска и результат: <span style="background-color:#7AE;color:white">текст77777</span>

### Диапазон повторений

Если требуется указать количество раз, сколько может повториться последовательность

### {0}

Указываем точную цифру сколько нужно повторять последовательность

- регулярное выражение: `/[0-9]{5}/g`
- строка поиска и результат: <span style="background-color:#7AE;color:white">12345</span>6789 

Символы будут повториться ровно 5 раз.

### {0,}

Символы будут повториться не менее указанных раз 

- регулярное выражение: `/[0-9]{5,}/g`
- строка поиска и результат: 1234
- строка поиска и результат: <span style="background-color:#7AE;color:white">12345678910</span>

В данных примерах символов должно быть или 5 или больше 5.

### {0,1}

Символы повторятся от и до раз.


- регулярное выражение: `/[0-9]{3,8}/g`
- строка поиска и результат: 12
  <span style="background-color:#7AE;color:white">123
  12345678
  12345678</span>9

 Строго от 3 до 8 символов, не больше не меньше.


> Квантификатор {0,1} на самом деле эквивалент ?
> Квантификатор {1,} на самом деле эквивалент +
> Квантификатор {0,} на самом деле эквивалент *

{: .prompt-info }

### Примеры

#### Первый

- регулярное выражение: `/\d\d\d\d\d\d\d\d\d/`
- строка поиска и результат: <span style="background-color:#7AE;color:white">123456789</span>

Согласитесь решение не красивое, сократим его указав `+`

- регулярное выражение: `/\d+/`
- строка поиска и результат: <span style="background-color:#7AE;color:white">123456789</span>

Вот теперь гораздо лучше

#### Второй

- регулярное выражение: `/\d+-\d+-\d+/g`
- строка поиска и результат: 123456789 <span style="background-color:#7AE;color:white">123-1234-123</span>

Вот теперь первый номер не попал в наше поле зрения. Поправим поставим `?` после дефиса.

- регулярное выражение: `/\d+-?\d+-?\d+/g`
- строка поиска и результат: <span style="background-color:#7AE;color:white">123456789 123-1234-123</span>

#### Третий

- регулярное выражение: `/\d+[- (]?\d+[- )]?\d+/g`
- строка поиска и результат: <span style="background-color:#7AE;color:white">123456789
  123-1234-123
  8(123)123123
  8 345 123456</span>

Здесь мы заменили дефисы на символьные классы

#### Четвертый

- регулярное выражение: `/\+?\d+[- (]?\d+[- )]?\d+/g`
- строка поиска и результат: <span style="background-color:#7AE;color:white">123456789
  123-1234-123
  8(123)123123
  8 345 123456
  +6 889 90000</span>

Нашли еще телефон с `+` добавив его присутствие или отсутствие с помощью экранирования.

https://habr.com/ru/articles/545150/
http://sajgak.ru/site/php/shpargalka-regularnie-virageniya-pcre/
https://devanych.ru/technologies/shpargalka-po-regulyarnym-vyrazheniyam
https://ru.hexlet.io/courses/regexp/lessons/symbols/theory_unit  

## Задачи 
 1

## Как составить регулярное выражение

Разложить его на части

Например, номер телефона

> Главное в регулярном выражении понять, не совпадает ли шаблон с тем, что не нужно.
{: .prompt-info }

## Примеры

Рассмотрим решение реальных примеров.
Возможно со временен соберем библиотеку регулярных выражений.

### Дата рождения

- регулярное выражение: `/(0?[1-9]|[12][0-9]|3[01]).(0?[1-9]|1[012]).((19|20)\d\d)/`
- строка поиска и результат: 
 

````text
/
    (
        0?
        [1-9]|[12]
        [0-9]|3[01]
    )
    .
    (
        0?
        [1-9]|1
        [012]
    )
    .
    (
        (19|20)
        \d\d
    )
/
````

## Модификаторы

Модифицировать дефолтное поведение регулярных выражений можно с помощью флагов (модификаторов) они указываются после строки-шаблона.

Основные из них:

- `g` ищет все совпадения, а не только первое вхождение
- `i` регистронезависимый поиск
- `m` мультистроковость
- `u` поддержка юникода




## Группа 

- `()`
Примеры:

| Строка поиска                                   | Выражение                     | Результат                                             | Описание                            |
|-------------------------------------------------|-------------------------------|-------------------------------------------------------|-------------------------------------|
| `гад сад рад`                                   | `/[гср]ад/gu`                 | **гад сад рад**                                       | Нашли все слова                     |
| `тест не тест место`                            | `/[е]ст/gu`                   | т**ест** не т**ест** м**ест**о                        | Нашли слово ест                     | 
| `какая-то строка`                               | `/[а-я- ]/gu`                 | **какая-то строка**                                   | Диапазон символов                   | 
| `12345`                                         | `/[0-9]/gu`                   | **12345**                                             | Поймаем все числа                   | 
| `12345абвкенг.`                                 | `/[0-9a-я.]/gu`               | **12345абвкенг.**                                     | И цифры и буквы и точка             | 
| `Договор№132А Договор№а123 договор не договора` | `/[дД]оговор№[a-яА-Я0-9]+/gu` | **Договор№132А** **Договор№а123** договор не договора | Найдем номера договоров             | 
| `123124dfg.;rt457!`                             | `/[^0-9]/gu`                  | 123124**dfg.;rt**457 **!**                            | Не числа                            | 
| ` hggh `                                        | `/\s/gu`                      | hggh                                                  | Нашли пробелы по краям              | 
| `русская строка_!5`                             | `/\w/gu`                      | **русская** **строка_**!**5**                         | Буква,цифра и _                     | 
| `880034545`                                     | `/\d+/u`                      | **880034545**                                         | Числа встречающиеся 1 или более раз | 
| `989++7`                                        | `/\++/u`                      | 989 **++** 7                                          | Символ `+` 1 или более раз          | 

https://habr.com/ru/articles/349860/
https://habr.com/ru/articles/545150/
http://sajgak.ru/site/php/shpargalka-regularnie-virageniya-pcre/

https://www.youtube.com/watch?v=ozFNilK4qrc&t=1290s

https://regex101.com/

https://devanych.ru/technologies/shpargalka-po-regulyarnym-vyrazheniyam
