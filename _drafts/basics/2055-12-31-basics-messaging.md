---
title: Обмен сообщениями
description: >-
  Как сервисы могут обмениваться сообщениями. Что это такое
author: alex
date: 2055-12-31 18:00:00 +0300
categories: [Basics]
tags: [messaging]
---

## Типы обмена

- Синхронный - Запрос/ответ
  - Отправляет запрос и ждем ответ 1 - 1 Самый простой вид коммуникации
- Асинхронный
  - Запрос / ответ уведомление - 1-*
  - Отправляем запрос и выполняем другие действия
  - Неважно когда придет ответ
  - Событие с ожиданием ответа

Делаем нашу архитектуру максимально асинхронной

## Форматы данных

- Текстовый (JSON,XML)
  - Простой
  - Обратная совместимость
  - Если нет требований
- Бинарный (Protobuf)
  - Компактность
  - Сильная типизация

## Типы транспортов

- Http
- gRpc

Брокеры сообщений
- rabitmq
- redis  in memory databases
- kafka

## Синхронная коммуникация

Проблемы:

- Отказоустойчивость при падении одного из сервисов, кушается память
- Мы должны понимать куда отправлять запрос
- Слабая доступность всех сервисов

Решение недоступности:

- Timeout
- Автоматический fail при накапливании сообщений до limit

Саморегистрация сервиса в каком-то общем реестре.
Нужен сервис который будет регистрировать сервисы

### Когда использовать эту модель

- Небольшой набор сервисов со слабой связанностью
- Хочется использовать Http (Swagger)

## Коммуникация через брокера

Кладем сообщение в очередь

Api -> Брокер -> Payment

- Запрос/Ответ
- Уведомление

### Что дает нам использование брокеров

- Слабую связанность сервисов
- Буферизация сообщений
- Разные паттерны коммуникации
- Персистенстность
