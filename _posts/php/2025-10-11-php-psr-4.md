---
title: PSR-4 автозагрузка классов в php
description: >-
  Стандарт PSR-4
author: alex
date: 2025-10-11 22:30:00 +0300
categories: [Php, PSR]
tags: [php]
image:
  path: /assets/img/posts/main/phpfig.png
  alt: Стандарты PSR в php
---

Стандарт `PSR-4` определяет правила автоматической загрузки классов по их пространству имен и пути к файлу без ручного
использования инструкций `require/include`.

`PSR-4` является стандартом для `composer`, что упрощает управление зависимостями в проектах.

## Как работает PSR-4

1. Преобразует имя класса с namespace в путь к файлу.
2. Заменяет разделители namespace `\` на разделители для директорий `/`.
3. Добавляет расширение `.php`.
4. Идет поиск файла в директории в настройках `composer.json`.

Как пример `namespace` будет преобразован в путь к файлу:

`App\Core\Handlers\Error` => `/src/Core/Handlers/Error/LogErrorHandler.php`.

## Настройка автозагрузки PSR-4 в composer

Теперь детальнее разберем настройку PSR-4 в composer. Соответствия указываются в секции `autoload` => `psr-4`.

Базовый синтаксис `"Префикс\\Пространства\\Имён\\": "Путь/К/Директории/"`

Рассмотрим пример пространство имен `App` директория `src`

````json
{
  "autoload": {
    "psr-4": {
      "App\\": "src"
    }
  }
}
````

Класс 

````php

declare(strict_types=1);

namespace App\Layout\Main;

use Yiisoft\Assets\AssetBundle;

final class MainAsset extends AssetBundle
{

}
````

Получается, что класс `MainAsset` автоматически подключится, то есть `namespace` `App\Layout\Main` будет преобразован 
в путь к файлу `/src/Layout/Main/MainAsset.php` то есть вырезав префикс `App` получаем путь к файлу.

Пространств имен может быть несколько

````json
{
  "autoload": {
    "psr-4": {
      "App\\": "src",
      "Bapp\\Tapp\\": "src1"
    }
  }
}
````

Определяем класс 

````php
<?php

declare(strict_types=1);

namespace Bapp\Tapp;

final readonly class ApplicationParams
{

}
````

И вызываем его в коде `$a = new \Bapp\Tapp\ApplicationParams();`

То есть пространство имен будет преобразовано в путь `Bapp\Tapp\ApplicationParams` => `/src1/ApplicationParams.php`

Для того чтобы обновить карту `composer` классов нужно запустить `composer dump-autoload`

В недрах `composer` пути хранятся примерно так

````php
[
'Bapp\\Tapp\\' => array($baseDir . '/src1'),
'App\\Tests\\' => array($baseDir . '/tests'),
'App\\' => array($baseDir . '/src'),
]

````

Также есть возможность указать глобальные классы, тогда они будут в глобальном `namespace`, и несколько директорий поиска классов, но это используется редко.

## Примеры путей

- `"Slim\\Psr7\\": "src"`
- `"Slim\\Tests\\Psr7\\": "tests"`
- `"DI\\": "src/"`
- `"PhpParser\\": "lib/PhpParser"`
- `"Yiisoft\\Definitions\\": "src"`
- `"Symfony\\Component\\Console\\": ""`

## Выводы

- Каждый сегмент `namespace` соответствует поддиректории.
- Имя файла = имя класса.
- Префикс `namespace` должен заканчиваться на `\\`.
- Для обновления нужно использовать команду `composer dump-autoload`.
- Вложенность может быть очень глубокой `composer` подключит все классы рекурсивно.
- Можно во всем проекте подключать классы через `use`.
- `PSR-4` является де-факто стандартом для разработки на `php`.

## Ссылки

- [https://www.php-fig.org/psr/psr-4/](https://www.php-fig.org/psr/psr-4/)
- [https://getcomposer.org/doc/04-schema.md#psr-4](https://getcomposer.org/doc/04-schema.md#psr-4)
